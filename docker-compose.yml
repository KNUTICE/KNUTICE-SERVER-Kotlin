services:
  api:
    build:
      context: .
      dockerfile: ./api/Dockerfile
    image: ${DOCKER_API_IMAGE_NAME}
    container_name: knutice-api
    ports:
      - ${API_PORT}:${API_PORT}
    networks:
      - app-network
    environment:
      - API_PORT
      - MONGO_URI
      - MONGO_DATABASE
      - JWT_ACCESS_PLUS_HOUR
      - JWT_REFRESH_PLUS_HOUR
      - JWT_SECRET_KEY
      - CRAWLER_SERVER_ADDRESS
      - FILE_UPLOAD_DIR
      - FILE_CONTEXT_PATH
      - URL_HOST
      - URL_SCHEME
      - WEBHOOK_SLACK_URL
      - LOG_PATH=/logs
      - TZ=Asia/Seoul
    volumes:
      - /home/ubuntu/knutice/logs/api:/logs
      - /home/ubuntu/knutice/images:/images

  crawler:
    build:
      context: .
      dockerfile: ./crawler/Dockerfile
    image: ${DOCKER_CRAWLER_IMAGE_NAME}
    container_name: knutice-crawler
    ports:
      - ${CRAWLER_PORT}:${CRAWLER_PORT}
    networks:
      - app-network
    environment:
      - CRAWLER_PORT
      - MONGO_URI
      - MONGO_DATABASE
      - FIREBASE_KEY_PATH
      - WEBHOOK_SLACK_URL
      - GEMINI_API_KEY
      - LOG_PATH=/logs
      - TZ=Asia/Seoul
    volumes:
      - /home/ubuntu/knutice/logs/crawler:/logs

networks:
  app-network:
    external: true